import{c as v,r as o,i as M,j as e,L as P,D as I,E as $,t as R,a as i,H}from"./index-CwcY_0GV.js";import{D as O}from"./dollar-sign-CB_kDrVo.js";import{S as W}from"./server-Dj5YMmSg.js";import{C as U}from"./check-Oue--1G2.js";const z=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],K=v("link",z);const V=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],D=v("log-out",V);const B=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],G=v("shield",B);const Q=[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]],J=v("webhook",Q);const X=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Y=v("wrench",X),Z=["debug","info","warning","error"];function j(s,a){const l={};for(const c of Object.keys(s))s[c]!==a[c]&&(l[c]=s[c]);return l}function u({icon:s,title:a,description:l,children:c}){return e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-5 sm:p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-accent/10",children:e.jsx(s,{className:"h-[18px] w-[18px] text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:a}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:l})]})]}),c]})}function m({htmlFor:s,children:a}){return e.jsx("label",{htmlFor:s,className:"block text-sm font-medium text-foreground mb-1.5",children:a})}function k({children:s}){return e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s})}const h=i("h-9 w-full rounded-lg border border-border bg-background px-3 text-sm text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring/30","transition-colors");function b({dirty:s,saving:a,onClick:l}){return e.jsxs("button",{disabled:!s||a,onClick:l,className:i("flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors",s?"bg-accent text-accent-foreground hover:bg-accent-hover shadow-sm hover:shadow-md cursor-pointer":"bg-border text-muted cursor-not-allowed"),children:[a&&e.jsx(R,{className:"h-3.5 w-3.5 animate-spin"}),"Save"]})}function ee({message:s,type:a}){return e.jsxs("div",{className:i("fixed bottom-6 right-6 z-50 flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium shadow-lg","animate-[fadeIn_0.2s_ease-out]",a==="success"?"bg-success/15 border border-success/30 text-success":"bg-error/15 border border-error/30 text-error"),children:[a==="success"?e.jsx(U,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"}),s]})}function oe(){const[s,a]=o.useState(null),[l,c]=o.useState(!0),[S,L]=o.useState(null),[x,q]=o.useState(new Set),[y,g]=o.useState(null),[w,A]=o.useState(!1),n=o.useRef(null),N=o.useCallback(async()=>{L(null);const t=await M.get("/settings");t.data?(a(t.data),n.current={...t.data}):t.error&&L(t.error.message||"Failed to load settings"),c(!1)},[]);o.useEffect(()=>{N()},[N]),o.useEffect(()=>{if(!y)return;const t=setTimeout(()=>g(null),3e3);return()=>clearTimeout(t)},[y]);function d(t,r){a(f=>f&&{...f,[t]:r})}function p(t){if(!s||!n.current)return!1;const r=n.current;switch(t){case"connections":return s.sandstorm_url!==r.sandstorm_url;case"credentials":return s.anthropic_api_key!==r.anthropic_api_key||s.e2b_api_key!==r.e2b_api_key;case"security":return s.auth_required!==r.auth_required||s.dashboard_origin!==r.dashboard_origin;case"budget":return s.default_max_cost_usd!==r.default_max_cost_usd;case"webhooks":return s.webhook_secret!==r.webhook_secret;case"system":return s.log_level!==r.log_level||s.max_workflow_depth!==r.max_workflow_depth}}function E(t){if(!s||!n.current)return{};const r=n.current;switch(t){case"connections":return j({sandstorm_url:s.sandstorm_url},{sandstorm_url:r.sandstorm_url});case"credentials":return j({anthropic_api_key:s.anthropic_api_key,e2b_api_key:s.e2b_api_key},{anthropic_api_key:r.anthropic_api_key,e2b_api_key:r.e2b_api_key});case"security":return j({auth_required:s.auth_required,dashboard_origin:s.dashboard_origin},{auth_required:r.auth_required,dashboard_origin:r.dashboard_origin});case"budget":return j({default_max_cost_usd:s.default_max_cost_usd},{default_max_cost_usd:r.default_max_cost_usd});case"webhooks":return j({webhook_secret:s.webhook_secret},{webhook_secret:r.webhook_secret});case"system":return j({log_level:s.log_level,max_workflow_depth:s.max_workflow_depth},{log_level:r.log_level,max_workflow_depth:r.max_workflow_depth})}}const _=o.useCallback(async t=>{const r=E(t);if(Object.keys(r).length===0)return;q(C=>new Set(C).add(t));const f=await M.patch("/settings",r);q(C=>{const F=new Set(C);return F.delete(t),F}),f.error?g({message:`Failed to save: ${f.error.message}`,type:"error"}):(n.current&&s&&(n.current={...s}),g({message:"Settings saved successfully",type:"success"}))},[s]),T=o.useCallback(async()=>{if(s){A(!0);try{const t=await fetch(`${s.sandstorm_url}/health`,{signal:AbortSignal.timeout(5e3)});t.ok?g({message:"Connection to Sandstorm successful",type:"success"}):g({message:`Sandstorm returned HTTP ${t.status}`,type:"error"})}catch{g({message:"Could not reach Sandstorm at this URL",type:"error"})}A(!1)}},[s]);return l?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(P,{size:"lg"})}):S||!s?e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center gap-3",children:[e.jsx(I,{className:"h-8 w-8 text-error"}),e.jsx("p",{className:"text-sm text-muted",children:S||"Could not load settings"}),e.jsx("button",{onClick:()=>{c(!0),N()},className:"rounded-lg border border-border px-4 py-2 text-sm font-medium text-foreground hover:bg-border/40 transition-colors",children:"Retry"})]}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"h-6 w-6 text-muted"}),e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Settings"})]}),e.jsx(u,{icon:K,title:"Connections",description:"Configure the upstream Sandstorm server URL",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"sandstorm_url",children:"Sandstorm URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"sandstorm_url",type:"text",className:h,value:s.sandstorm_url,onChange:t=>d("sandstorm_url",t.target.value),placeholder:"http://localhost:8080"}),e.jsx("button",{onClick:T,disabled:w,className:i("shrink-0 rounded-lg border border-border px-3 py-2 text-sm font-medium","text-muted hover:text-foreground hover:bg-border/40 transition-colors",w&&"opacity-50 cursor-not-allowed"),children:w?e.jsx(R,{className:"h-4 w-4 animate-spin"}):"Test"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{dirty:p("connections"),saving:x.has("connections"),onClick:()=>{_("connections")}})})]})}),e.jsx(u,{icon:H,title:"API Credentials",description:"Manage API keys for external services",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"anthropic_api_key",children:"Anthropic API Key"}),e.jsx("input",{id:"anthropic_api_key",type:"password",className:h,value:s.anthropic_api_key,onChange:t=>d("anthropic_api_key",t.target.value),placeholder:n.current?.anthropic_api_key||"sk-ant-..."})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"e2b_api_key",children:"E2B API Key"}),e.jsx("input",{id:"e2b_api_key",type:"password",className:h,value:s.e2b_api_key,onChange:t=>d("e2b_api_key",t.target.value),placeholder:n.current?.e2b_api_key||"e2b_..."})]}),e.jsx(k,{children:"Leave empty to keep the current value. Values are masked for security."}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{dirty:p("credentials"),saving:x.has("credentials"),onClick:()=>{_("credentials")}})})]})}),e.jsx(u,{icon:G,title:"Security",description:"Authentication and CORS settings",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Auth Required"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Require API key authentication for all requests"})]}),e.jsx("button",{role:"switch","aria-checked":s.auth_required,onClick:()=>d("auth_required",!s.auth_required),className:i("relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors",s.auth_required?"bg-accent":"bg-border"),children:e.jsx("span",{className:i("pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow-sm transition-transform",s.auth_required?"translate-x-5":"translate-x-0")})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"dashboard_origin",children:"Dashboard Origin"}),e.jsx("input",{id:"dashboard_origin",type:"text",className:h,value:s.dashboard_origin,onChange:t=>d("dashboard_origin",t.target.value),placeholder:"http://localhost:5173"}),e.jsx(k,{children:"Allowed CORS origin for the dashboard"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{dirty:p("security"),saving:x.has("security"),onClick:()=>{_("security")}})})]})}),e.jsx(u,{icon:O,title:"Budget & Costs",description:"Default cost limits for workflow runs",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"default_max_cost_usd",children:"Default Max Cost per Run (USD)"}),e.jsx("input",{id:"default_max_cost_usd",type:"number",min:0,step:.01,className:i(h,"max-w-xs"),value:s.default_max_cost_usd,onChange:t=>d("default_max_cost_usd",parseFloat(t.target.value)||0)}),e.jsx(k,{children:"0 = unlimited"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{dirty:p("budget"),saving:x.has("budget"),onClick:()=>{_("budget")}})})]})}),e.jsx(u,{icon:J,title:"Webhooks",description:"Webhook HMAC signing configuration",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"webhook_secret",children:"Webhook Secret"}),e.jsx("input",{id:"webhook_secret",type:"password",className:h,value:s.webhook_secret,onChange:t=>d("webhook_secret",t.target.value),placeholder:n.current?.webhook_secret||"whsec_..."}),e.jsx(k,{children:"Used to sign outgoing webhook payloads (HMAC-SHA256)"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{dirty:p("webhooks"),saving:x.has("webhooks"),onClick:()=>{_("webhooks")}})})]})}),e.jsx(u,{icon:Y,title:"System",description:"Logging and execution limits",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"log_level",children:"Log Level"}),e.jsx("select",{id:"log_level",className:i(h,"max-w-xs cursor-pointer"),value:s.log_level,onChange:t=>d("log_level",t.target.value),children:Z.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"max_workflow_depth",children:"Max Workflow Depth"}),e.jsx("input",{id:"max_workflow_depth",type:"number",min:1,max:20,className:i(h,"max-w-xs"),value:s.max_workflow_depth,onChange:t=>d("max_workflow_depth",Math.min(20,Math.max(1,parseInt(t.target.value,10)||1)))}),e.jsx(k,{children:"Maximum nesting depth for sub-workflows (1-20)"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{dirty:p("system"),saving:x.has("system"),onClick:()=>{_("system")}})})]})}),localStorage.getItem("sandcastle_api_key")&&e.jsx(u,{icon:D,title:"Session",description:"Connected via saved API key",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Key: ",e.jsxs("span",{className:"font-mono",children:[localStorage.getItem("sandcastle_api_key")?.slice(0,8),"..."]})]}),e.jsxs("button",{onClick:()=>{localStorage.removeItem("sandcastle_api_key"),window.location.reload()},className:"flex items-center gap-2 rounded-lg border border-error/30 px-3 py-1.5 text-sm font-medium text-error hover:bg-error/10 transition-colors cursor-pointer",children:[e.jsx(D,{className:"h-3.5 w-3.5"}),"Disconnect"]})]})}),e.jsx(u,{icon:W,title:"Infrastructure",description:"Runtime environment and storage configuration (read-only)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Mode"}),e.jsx("span",{className:i("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.is_local_mode?"bg-accent/15 border border-accent/30 text-accent":"bg-success/15 border border-success/30 text-success"),children:s.is_local_mode?"Local":"Production"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Database"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.database_url||"Not configured"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Queue"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.redis_url||"In-process"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Storage"}),e.jsxs("p",{className:"text-sm text-muted-foreground font-mono truncate",children:[s.storage_backend,s.storage_bucket?` / ${s.storage_bucket}`:"",s.storage_endpoint?` (${s.storage_endpoint})`:""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Data Directory"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.data_dir||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Workflows Directory"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.workflows_dir||"-"})]})]})]})}),y&&e.jsx(ee,{message:y.message,type:y.type})]})}export{oe as default};
