import{j as e,h as D,a as h,r as d,i as C,X as $,t as W,L as T,B as M}from"./index-CwcY_0GV.js";import{J as F}from"./JsonEditor-0xhpzzMy.js";import{E as O}from"./EmptyState-BQhpdpld.js";import{P as A}from"./plus-BelFDhcy.js";const J=[{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6},{label:"Sun",value:0}];function L(o){const t={frequency:"daily",hour:9,minute:0,interval:6,weekdays:[1,2,3,4,5],monthDay:1};if(!o)return t;const i=o.trim().split(/\s+/);if(i.length!==5)return{...t,frequency:"custom"};const[n,s,r,,c]=i;if(s==="*"&&r==="*"&&c==="*")return{...t,frequency:"hourly",minute:parseInt(n)||0};if(s.startsWith("*/")&&r==="*"&&c==="*")return{...t,frequency:"every_x_hours",minute:parseInt(n)||0,interval:parseInt(s.slice(2))||6};if(r==="*"&&c!=="*"&&!s.includes("*")&&!s.includes("/")){const u=c.split(",").map(Number).filter(f=>!isNaN(f));return{...t,frequency:"weekly",minute:parseInt(n)||0,hour:parseInt(s)||9,weekdays:u.length>0?u:[1,2,3,4,5]}}return r!=="*"&&!r.includes("*")&&c==="*"&&!s.includes("*")?{...t,frequency:"monthly",minute:parseInt(n)||0,hour:parseInt(s)||9,monthDay:parseInt(r)||1}:r==="*"&&c==="*"&&!s.includes("*")&&!s.includes("/")?{...t,frequency:"daily",minute:parseInt(n)||0,hour:parseInt(s)||9}:{...t,frequency:"custom"}}function q(o){const t=L(o),i=s=>String(s).padStart(2,"0"),n=`${i(t.hour)}:${i(t.minute)}`;switch(t.frequency){case"hourly":return t.minute===0?"Every hour":`Every hour at :${i(t.minute)}`;case"every_x_hours":return`Every ${t.interval} hours`;case"daily":return`Daily at ${n}`;case"weekly":{const s=t.weekdays.sort((r,c)=>r-c).map(r=>J.find(c=>c.value===r)?.label||String(r));return s.length===5&&!t.weekdays.includes(0)&&!t.weekdays.includes(6)?`Weekdays at ${n}`:s.length===7?`Daily at ${n}`:`${s.join(", ")} at ${n}`}case"monthly":return`Monthly on day ${t.monthDay} at ${n}`;case"custom":return o}}function z({schedules:o,onToggle:t,onDelete:i,onEdit:n}){return e.jsx("div",{className:"rounded-xl border border-border bg-surface shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-background/50",children:[e.jsx("th",{className:"px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Workflow"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Schedule"}),e.jsx("th",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Created"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-center font-medium text-muted",children:"Enabled"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-right font-medium text-muted",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:o.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 sm:px-5 py-3 font-medium text-foreground",children:s.workflow_name}),e.jsxs("td",{className:"px-3 sm:px-5 py-3",children:[e.jsx("span",{className:"text-foreground text-xs",children:q(s.cron_expression)}),e.jsx("span",{className:"hidden sm:inline ml-2 font-mono text-[11px] text-muted-foreground",children:s.cron_expression})]}),e.jsx("td",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-muted",children:s.created_at?D(s.created_at):"-"}),e.jsx("td",{className:"px-3 sm:px-5 py-3 text-center",children:e.jsx("button",{onClick:()=>t(s.id,!s.enabled),className:h("relative inline-flex h-5 w-9 items-center rounded-full transition-colors duration-200",s.enabled?"bg-success":"bg-border"),children:e.jsx("span",{className:h("inline-block h-3.5 w-3.5 rounded-full bg-white shadow-sm transition-transform duration-200",s.enabled?"translate-x-[18px]":"translate-x-[3px]")})})}),e.jsx("td",{className:"px-3 sm:px-5 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>n(s),className:"text-xs text-accent/70 hover:text-accent transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>i(s.id),className:"text-xs text-error/70 hover:text-error transition-colors",children:"Delete"})]})})]},s.id))})]})})})}const B=[{label:"Mon",value:1},{label:"Tue",value:2},{label:"Wed",value:3},{label:"Thu",value:4},{label:"Fri",value:5},{label:"Sat",value:6},{label:"Sun",value:0}];function H(o){const t={frequency:"daily",hour:9,minute:0,interval:6,weekdays:[1,2,3,4,5],monthDay:1};if(!o)return t;const i=o.trim().split(/\s+/);if(i.length!==5)return{...t,frequency:"custom"};const[n,s,r,,c]=i;if(s==="*"&&r==="*"&&c==="*")return{...t,frequency:"hourly",minute:parseInt(n)||0};if(s.startsWith("*/")&&r==="*"&&c==="*")return{...t,frequency:"every_x_hours",minute:parseInt(n)||0,interval:parseInt(s.slice(2))||6};if(r==="*"&&c!=="*"&&!s.includes("*")&&!s.includes("/")){const u=c.split(",").map(Number).filter(f=>!isNaN(f));return{...t,frequency:"weekly",minute:parseInt(n)||0,hour:parseInt(s)||9,weekdays:u.length>0?u:[1,2,3,4,5]}}return r!=="*"&&!r.includes("*")&&c==="*"&&!s.includes("*")?{...t,frequency:"monthly",minute:parseInt(n)||0,hour:parseInt(s)||9,monthDay:parseInt(r)||1}:r==="*"&&c==="*"&&!s.includes("*")&&!s.includes("/")?{...t,frequency:"daily",minute:parseInt(n)||0,hour:parseInt(s)||9}:{...t,frequency:"custom"}}function _(o){const t=o.minute,i=o.hour;switch(o.frequency){case"hourly":return`${t} * * * *`;case"every_x_hours":return`${t} */${o.interval} * * *`;case"daily":return`${t} ${i} * * *`;case"weekly":return`${t} ${i} * * ${o.weekdays.sort((n,s)=>n-s).join(",")}`;case"monthly":return`${t} ${i} ${o.monthDay} * *`;case"custom":return o.custom}}function I({value:o,onChange:t}){const i=H(o),[n,s]=d.useState(i.frequency),[r,c]=d.useState(i.hour),[u,f]=d.useState(i.minute),[v,k]=d.useState(i.interval),[j,g]=d.useState(i.weekdays),[m,b]=d.useState(i.monthDay),[p,x]=d.useState(o||"0 9 * * *");d.useEffect(()=>{const a=_({frequency:n,hour:r,minute:u,interval:v,weekdays:j,monthDay:m,custom:p});t(a)},[n,r,u,v,j,m,p,t]);const N=h("h-9 rounded-lg border border-border bg-background px-3 text-sm","focus:border-accent/50 focus:outline-none focus:ring-2 focus:ring-ring/30"),E=_({frequency:n,hour:r,minute:u,interval:v,weekdays:j,monthDay:m,custom:p});return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Frequency"}),e.jsxs("select",{value:n,onChange:a=>s(a.target.value),className:h(N,"w-full"),children:[e.jsx("option",{value:"hourly",children:"Every hour"}),e.jsx("option",{value:"every_x_hours",children:"Every X hours"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"custom",children:"Custom (cron)"})]})]}),n==="every_x_hours"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Every"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:v,onChange:a=>k(Number(a.target.value)),className:h(N,"w-24"),children:[2,3,4,6,8,12].map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("span",{className:"text-sm text-muted",children:"hours"})]})]}),(n==="daily"||n==="weekly"||n==="monthly")&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Time"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:r,onChange:a=>c(Number(a.target.value)),className:h(N,"w-20"),children:Array.from({length:24},(a,l)=>e.jsx("option",{value:l,children:String(l).padStart(2,"0")},l))}),e.jsx("span",{className:"text-sm font-medium text-muted",children:":"}),e.jsx("select",{value:u,onChange:a=>f(Number(a.target.value)),className:h(N,"w-20"),children:[0,15,30,45].map(a=>e.jsx("option",{value:a,children:String(a).padStart(2,"0")},a))})]})]}),n==="weekly"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Days"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:B.map(a=>{const l=j.includes(a.value);return e.jsx("button",{type:"button",onClick:()=>{l?j.length>1&&g(j.filter(y=>y!==a.value)):g([...j,a.value])},className:h("rounded-md px-2.5 py-1 text-xs font-medium transition-colors",l?"bg-accent text-accent-foreground":"bg-background border border-border text-muted hover:text-foreground"),children:a.label},a.value)})}),e.jsxs("div",{className:"flex gap-2 mt-1.5",children:[e.jsx("button",{type:"button",onClick:()=>g([1,2,3,4,5]),className:"text-[11px] text-accent/70 hover:text-accent transition-colors",children:"Weekdays"}),e.jsx("button",{type:"button",onClick:()=>g([0,1,2,3,4,5,6]),className:"text-[11px] text-accent/70 hover:text-accent transition-colors",children:"Every day"})]})]}),n==="monthly"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Day of month"}),e.jsx("select",{value:m,onChange:a=>b(Number(a.target.value)),className:h(N,"w-24"),children:Array.from({length:28},(a,l)=>e.jsx("option",{value:l+1,children:l+1},l+1))})]}),n==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Cron Expression"}),e.jsx("input",{type:"text",value:p,onChange:a=>x(a.target.value),placeholder:"0 */6 * * *",className:h(N,"w-full font-mono")}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:"Format: minute hour day month weekday"})]}),e.jsxs("div",{className:"rounded-md bg-background border border-border px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted",children:"Schedule:"}),e.jsx("span",{className:"text-xs font-medium text-foreground",children:q(E)})]}),e.jsxs("div",{className:"flex items-center justify-between mt-0.5",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Cron:"}),e.jsx("code",{className:"text-[11px] font-mono text-muted-foreground",children:E})]})]})]})}function K({open:o,onClose:t,onSubmit:i}){const[n,s]=d.useState([]),[r,c]=d.useState(!1),[u,f]=d.useState(""),[v,k]=d.useState("0 9 * * *"),[j,g]=d.useState("{}"),[m,b]=d.useState({});if(d.useEffect(()=>{o&&(c(!0),C.get("/workflows").then(l=>{l.data&&s(l.data)}).finally(()=>c(!1)))},[o]),!o)return null;const p=n.find(l=>l.file_name.replace(".yaml","")===u),x=p?.input_schema,N=x&&x.properties&&Object.keys(x.properties).length>0;function E(l){l.preventDefault();let y={};if(N){for(const[S,w]of Object.entries(m))w!==""&&(y[S]=w);if(x?.properties)for(const[S,w]of Object.entries(x.properties))!(S in y)&&w.default!==void 0&&(y[S]=w.default)}else try{y=JSON.parse(j)}catch{}i({workflow_name:u,cron_expression:v,input_data:y}),f(""),k("0 9 * * *"),g("{}"),b({})}const a=h("h-9 w-full rounded-lg border border-border bg-background px-3 text-sm","focus:border-accent/50 focus:outline-none focus:ring-2 focus:ring-ring/30");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40",onClick:t}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-border bg-surface p-6 shadow-xl max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"New Schedule"}),e.jsx("button",{onClick:t,className:"rounded-lg p-1 text-muted hover:text-foreground",children:e.jsx($,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Workflow"}),r?e.jsxs("div",{className:"flex items-center gap-2 h-9 px-3 text-sm text-muted",children:[e.jsx(W,{className:"h-3.5 w-3.5 animate-spin"}),"Loading workflows..."]}):n.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No workflows found. Create one first."}):e.jsxs("select",{value:u,onChange:l=>{f(l.target.value),b({})},required:!0,className:a,children:[e.jsx("option",{value:"",children:"Select a workflow..."}),n.map(l=>e.jsx("option",{value:l.file_name.replace(".yaml",""),children:l.name||l.file_name.replace(".yaml","")},l.file_name))]}),p?.description&&e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:p.description})]}),e.jsx(I,{value:v,onChange:k}),u&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Input Data"}),N?e.jsx("div",{className:"space-y-2.5",children:Object.entries(x.properties).map(([l,y])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[e.jsx("span",{className:"text-xs text-foreground",children:l}),x.required?.includes(l)&&e.jsx("span",{className:"text-[10px] text-error",children:"*"})]}),e.jsx("input",{type:"text",value:m[l]??(y.default!==void 0?String(y.default):""),onChange:S=>b(w=>({...w,[l]:S.target.value})),placeholder:y.description||l,required:x.required?.includes(l),className:h(a,"text-xs")}),y.description&&e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:y.description})]},l))}):e.jsxs(e.Fragment,{children:[e.jsx(F,{value:j,onChange:g,rows:3}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:"JSON passed to the workflow as {input.*} variables."})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:t,className:"rounded-lg border border-border px-4 py-2 text-sm font-medium text-muted hover:text-foreground transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!u,className:h("rounded-lg bg-accent px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200","shadow-sm hover:shadow-md","disabled:opacity-50 disabled:cursor-not-allowed"),children:"Create Schedule"})]})]})]})})]})}function P({open:o,schedule:t,onClose:i,onSubmit:n}){const[s,r]=d.useState(t.cron_expression),[c,u]=d.useState(t.enabled);if(!o)return null;function f(v){v.preventDefault(),n(t.id,{cron_expression:s,enabled:c})}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40",onClick:i}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-border bg-surface p-6 shadow-xl max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Edit Schedule"}),e.jsx("button",{onClick:i,className:"rounded-lg p-1 text-muted hover:text-foreground",children:e.jsx($,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Workflow"}),e.jsx("p",{className:"text-sm text-foreground",children:t.workflow_name})]}),e.jsx(I,{value:s,onChange:r}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-muted",children:"Enabled"}),e.jsx("button",{type:"button",onClick:()=>u(!c),className:h("relative inline-flex h-5 w-9 items-center rounded-full transition-colors duration-200",c?"bg-success":"bg-border"),children:e.jsx("span",{className:h("inline-block h-3.5 w-3.5 rounded-full bg-white shadow-sm transition-transform duration-200",c?"translate-x-[18px]":"translate-x-[3px]")})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"rounded-lg border border-border px-4 py-2 text-sm font-medium text-muted hover:text-foreground transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:h("rounded-lg bg-accent px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200","shadow-sm hover:shadow-md"),children:"Save Changes"})]})]})]})})]})}function Q(){const[o,t]=d.useState([]),[i,n]=d.useState(!0),[s,r]=d.useState(!1),[c,u]=d.useState(null),f=d.useCallback(async()=>{try{const m=await C.get("/schedules");m.data&&t(m.data)}finally{n(!1)}},[]);d.useEffect(()=>{f()},[f]);const v=d.useCallback(async(m,b)=>{await C.patch(`/schedules/${m}`,{enabled:b}),t(p=>p.map(x=>x.id===m?{...x,enabled:b}:x))},[]),k=d.useCallback(async m=>{await C.delete(`/schedules/${m}`),t(b=>b.filter(p=>p.id!==m))},[]),j=d.useCallback(async m=>{await C.post("/schedules",m),r(!1),f()},[f]),g=d.useCallback(async(m,b)=>{await C.patch(`/schedules/${m}`,b),t(p=>p.map(x=>x.id===m?{...x,...b}:x)),u(null)},[]);return i?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(T,{size:"lg"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Schedules"}),e.jsxs("button",{onClick:()=>r(!0),className:h("flex items-center gap-2 rounded-lg bg-accent px-3 sm:px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200","shadow-sm hover:shadow-md"),children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"New Schedule"})]})]}),o.length===0?e.jsx(O,{icon:M,title:"No schedules yet",description:"Automate your first workflow!",action:{label:"New Schedule",onClick:()=>r(!0)}}):e.jsx(z,{schedules:o,onToggle:v,onDelete:k,onEdit:u}),e.jsx(K,{open:s,onClose:()=>r(!1),onSubmit:j}),c&&e.jsx(P,{open:!0,schedule:c,onClose:()=>u(null),onSubmit:g})]})}export{Q as default};
