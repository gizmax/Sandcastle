import{u as _,r,i as x,j as e,L as S,a,w as m,h as C}from"./index-CwcY_0GV.js";import{E}from"./EmptyState-BQhpdpld.js";import{C as T}from"./circle-check-BE3fso_r.js";import{C as L}from"./chevron-up-CHQN3fbL.js";import{C as P}from"./chevron-down-D_IPnZAM.js";const u={critical:{bg:"bg-error/15 border-error/30",text:"text-error",dot:"bg-error animate-pulse",label:"Critical"},high:{bg:"bg-warning/15 border-warning/30",text:"text-warning",dot:"bg-warning",label:"High"},medium:{bg:"bg-accent/15 border-accent/30",text:"text-accent",dot:"bg-accent",label:"Medium"},low:{bg:"bg-muted/15 border-muted/30",text:"text-muted",dot:"bg-muted",label:"Low"}},g={blocked:"bg-error/10 text-error",redacted:"bg-warning/10 text-warning",flagged:"bg-accent/10 text-accent",logged:"bg-muted/10 text-muted"};function H(){const p=_(),[n,h]=r.useState([]),[o,b]=r.useState(null),[f,j]=r.useState(!0),[l,N]=r.useState("all"),[v,w]=r.useState(null),c=r.useCallback(async()=>{try{const t={};l!=="all"&&(t.severity=l);const[s,d]=await Promise.all([x.get("/violations",t),x.get("/violations/stats")]);s.data&&h(s.data),d.data&&b(d.data)}finally{j(!1)}},[l]);r.useEffect(()=>{c()},[c]);const y=[{key:"all",label:"All"},{key:"critical",label:"Critical"},{key:"high",label:"High"},{key:"medium",label:"Medium"},{key:"low",label:"Low"}];return f?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(S,{size:"lg"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Policy Violations"})}),o&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Total Violations (30d)"}),e.jsx("p",{className:"mt-1 text-xl sm:text-2xl font-semibold text-foreground",children:o.total_violations_30d})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Critical"}),e.jsx("p",{className:"mt-1 text-xl sm:text-2xl font-semibold text-error",children:o.violations_by_severity.critical||0})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"High"}),e.jsx("p",{className:"mt-1 text-xl sm:text-2xl font-semibold text-warning",children:o.violations_by_severity.high||0})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-4 shadow-sm",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Top Policy"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:Object.entries(o.violations_by_policy).sort(([,t],[,s])=>s-t)[0]?.[0]||"-"})]})]}),e.jsx("div",{className:"flex gap-1 rounded-lg bg-background p-1",children:y.map(t=>e.jsx("button",{onClick:()=>N(t.key),className:a("rounded-md px-3 py-1.5 text-sm font-medium transition-all duration-200",l===t.key?"bg-surface text-foreground shadow-sm":"text-muted hover:text-foreground"),children:t.label},t.key))}),n.length===0?e.jsx(E,{icon:m,title:"No violations",description:"Policy violations from workflow runs will appear here."}):e.jsx("div",{className:"space-y-3",children:n.map(t=>{const s=u[t.severity]||u.low,d=g[t.action_taken]||g.logged,i=v===t.id;return e.jsxs("div",{className:"rounded-xl border border-border bg-surface shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 px-5 py-4 cursor-pointer hover:bg-border/10 transition-colors",onClick:()=>w(i?null:t.id),children:[e.jsx("div",{className:a("flex h-10 w-10 shrink-0 items-center justify-center rounded-lg border",s.bg),children:e.jsx(m,{className:a("h-5 w-5",s.text)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:t.policy_id}),e.jsx("button",{onClick:k=>{k.stopPropagation(),p(`/runs/${t.run_id}`)},className:"text-xs font-medium text-accent hover:text-accent-hover transition-colors",children:t.step_id})]}),e.jsx("div",{className:"flex items-center gap-3 mt-1",children:e.jsx("p",{className:"text-xs text-muted truncate max-w-md",children:t.trigger_details})})]}),t.output_modified&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium text-success",children:[e.jsx(T,{className:"h-3.5 w-3.5"}),"Modified"]}),e.jsx("span",{className:a("rounded-full px-2 py-0.5 text-xs font-medium",d),children:t.action_taken}),e.jsxs("span",{className:a("inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium",s.bg,s.text),children:[e.jsx("span",{className:a("h-1.5 w-1.5 rounded-full",s.dot)}),s.label]}),e.jsx("span",{className:"text-xs text-muted shrink-0",children:C(t.created_at)}),i?e.jsx(L,{className:"h-4 w-4 text-muted shrink-0"}):e.jsx(P,{className:"h-4 w-4 text-muted shrink-0"})]}),i&&e.jsxs("div",{className:"border-t border-border px-5 py-4 bg-background/50",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Trigger Details"}),e.jsx("pre",{className:"max-h-48 overflow-auto rounded-lg bg-surface border border-border p-3 font-mono text-xs text-muted whitespace-pre-wrap",children:t.trigger_details}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-xs text-muted",children:[e.jsxs("span",{children:["Run: ",e.jsx("span",{className:"font-mono text-foreground",children:t.run_id.slice(0,8)})]}),e.jsxs("span",{children:["Step: ",e.jsx("span",{className:"font-medium text-foreground",children:t.step_id})]}),e.jsxs("span",{children:["Action: ",e.jsx("span",{className:"font-medium text-foreground",children:t.action_taken})]}),t.output_modified&&e.jsx("span",{className:"text-success font-medium",children:"Output was modified"})]})]})]},t.id)})})]})}export{H as default};
