import{r,i as y,P as z,u as A,j as e,h as F,f as B,a as b,p as R,b as M,S as q,l as I,L as O,m as W}from"./index-CwcY_0GV.js";import{t as v}from"./index-Bw4YkTyy.js";import{R as U}from"./RunStatusBadge-CZgT1mF0.js";import{C as T}from"./ConfirmDialog-CnKxRn7f.js";import{E as V}from"./EmptyState-BQhpdpld.js";import{T as X}from"./trash-2-203UugO-.js";import"./index-XYXLuPD8.js";function G(c={}){const{status:x,workflow:o,limit:u=50,offset:i=0,autoPoll:f=!0}=c,[m,j]=r.useState([]),[a,p]=r.useState(0),[g,l]=r.useState(!0),h=r.useCallback(async()=>{const t={limit:String(u),offset:String(i)};x&&(t.status=x),o&&(t.workflow=o);const n=await y.get("/runs",t);n.data&&(j(n.data),p(n.meta?.total??n.data.length)),l(!1)},[x,o,u,i]);return r.useEffect(()=>{h()},[h]),r.useEffect(()=>{if(!f||!m.some(w=>w.status==="running"||w.status==="queued"))return;const n=setInterval(h,z);return()=>clearInterval(n)},[m,f,h]),{runs:m,total:a,loading:g,refetch:h}}function H({runs:c,total:x,limit:o,offset:u,onPageChange:i,selectedIds:f,onSelectionChange:m}){const j=A(),a=!!m,p=a&&c.length>0&&c.every(t=>f?.has(t.run_id)),g=Math.ceil(x/o),l=Math.floor(u/o)+1;function h(t){if(!t.started_at)return"-";const n=R(t.started_at).getTime(),w=t.completed_at?R(t.completed_at).getTime():Date.now();return M((w-n)/1e3)}return e.jsxs("div",{className:"rounded-xl border border-border bg-surface shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-background/50",children:[a&&e.jsx("th",{className:"w-10 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{m?.(p?new Set:new Set(c.map(t=>t.run_id)))},className:"h-4 w-4 rounded border-border accent-accent"})}),e.jsx("th",{className:"hidden sm:table-cell px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Workflow"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Status"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Started"}),e.jsx("th",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Duration"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-right font-medium text-muted",children:"Cost"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:c.map(t=>e.jsxs("tr",{onClick:()=>j(`/runs/${t.run_id}`),className:b("cursor-pointer transition-colors duration-150 hover:bg-border/20",f?.has(t.run_id)&&"bg-accent/5"),children:[a&&e.jsx("td",{className:"w-10 px-3 py-3",onClick:n=>n.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:f?.has(t.run_id)??!1,onChange:()=>{const n=new Set(f);n.has(t.run_id)?n.delete(t.run_id):n.add(t.run_id),m?.(n)},className:"h-4 w-4 rounded border-border accent-accent"})}),e.jsx("td",{className:"hidden sm:table-cell px-3 sm:px-5 py-3 font-medium text-foreground",children:t.workflow_name}),e.jsx("td",{className:"px-3 sm:px-5 py-3",children:e.jsx(U,{status:t.status})}),e.jsx("td",{className:"px-3 sm:px-5 py-3 text-muted",children:t.started_at?F(t.started_at):"queued"}),e.jsx("td",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-muted",children:h(t)}),e.jsx("td",{className:"px-3 sm:px-5 py-3 text-right font-mono text-muted",children:B(t.total_cost_usd)})]},t.run_id))})]})}),g>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-border px-3 sm:px-5 py-3",children:[e.jsxs("p",{className:"text-xs text-muted",children:["Showing ",u+1,"-",Math.min(u+o,x)," of ",x]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{disabled:l<=1,onClick:()=>i(Math.max(0,u-o)),className:b("rounded-md px-3 py-1 text-xs font-medium","transition-colors duration-150",l<=1?"text-muted-foreground/40 cursor-not-allowed":"text-muted hover:bg-border/40 hover:text-foreground"),children:"Previous"}),e.jsxs("span",{className:"px-2 text-xs text-muted",children:[l," / ",g]}),e.jsx("button",{disabled:l>=g,onClick:()=>i(u+o),className:b("rounded-md px-3 py-1 text-xs font-medium","transition-colors duration-150",l>=g?"text-muted-foreground/40 cursor-not-allowed":"text-muted hover:bg-border/40 hover:text-foreground"),children:"Next"})]})]})]})}const J=["all","queued","running","completed","failed","partial"];function re(){const[c,x]=r.useState("all"),[o,u]=r.useState(""),[i,f]=r.useState(""),[m,j]=r.useState(0),[a,p]=r.useState(new Set),[g,l]=r.useState(null),[h,t]=r.useState(!1),[n,w]=r.useState([]),S=20;r.useEffect(()=>{y.get("/workflows").then(s=>{s.data&&w(s.data)})},[]);const{runs:k,total:$,loading:D,refetch:N}=G({status:c==="all"?void 0:c,workflow:o||void 0,limit:S,offset:m}),_=r.useMemo(()=>{if(!i)return k;const s=i.toLowerCase();return k.filter(d=>d.run_id.toLowerCase().includes(s)||d.workflow_name.toLowerCase().includes(s))},[k,i]),L=r.useCallback(async()=>{t(!0);let s=0,d=0;for(const C of a)(await y.delete(`/runs/${C}`)).error?d++:s++;t(!1),l(null),p(new Set),s>0&&v.success(`Deleted ${s} run${s>1?"s":""}`),d>0&&v.error(`Failed to delete ${d} run${d>1?"s":""}`),N()},[a,N]),P=r.useCallback(async()=>{t(!0);let s=0,d=0;for(const C of a)(await y.post(`/runs/${C}/cancel`)).error?d++:s++;t(!1),l(null),p(new Set),s>0&&v.success(`Cancelled ${s} run${s>1?"s":""}`),d>0&&v.error(`Failed to cancel ${d} run${d>1?"s":""}`),N()},[a,N]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Runs"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:J.map(s=>e.jsx("button",{onClick:()=>{x(s),j(0)},className:b("rounded-lg px-3 py-1.5 text-xs font-medium capitalize transition-all duration-200",c===s?"bg-accent text-accent-foreground shadow-sm":"bg-border/40 text-muted hover:bg-border hover:text-foreground"),children:s},s))}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted"}),e.jsx("input",{type:"text",value:i,onChange:s=>f(s.target.value),placeholder:"Search by ID or name...",className:b("h-8 w-48 rounded-lg border border-border bg-background pl-8 pr-3 text-xs","focus:border-accent/50 focus:outline-none focus:ring-2 focus:ring-ring/30")})]}),e.jsxs("select",{value:o,onChange:s=>{u(s.target.value),j(0)},className:b("h-8 rounded-lg border border-border bg-background px-2.5 text-xs text-foreground","focus:border-accent/50 focus:outline-none focus:ring-2 focus:ring-ring/30"),children:[e.jsx("option",{value:"",children:"All workflows"}),n.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]})]})]}),a.size>0&&e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-accent/30 bg-accent/5 px-4 py-2.5",children:[e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[a.size," selected"]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs("button",{onClick:()=>l("cancel"),className:b("flex items-center gap-1.5 rounded-lg border border-warning/30 px-3 py-1.5","text-xs font-medium text-warning","hover:bg-warning/10 transition-colors"),children:[e.jsx(I,{className:"h-3.5 w-3.5"}),"Cancel selected"]}),e.jsxs("button",{onClick:()=>l("delete"),className:b("flex items-center gap-1.5 rounded-lg border border-error/30 px-3 py-1.5","text-xs font-medium text-error","hover:bg-error/10 transition-colors"),children:[e.jsx(X,{className:"h-3.5 w-3.5"}),"Delete selected"]}),e.jsx("button",{onClick:()=>p(new Set),className:"text-xs text-muted hover:text-foreground transition-colors ml-1",children:"Clear"})]})]}),D?e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(O,{})}):_.length===0?e.jsx(V,{icon:W,title:c!=="all"||o||i?"No runs match your filters":"No runs yet",description:c!=="all"||o||i?"Try adjusting your filters.":"Run a workflow to see execution history here.",action:c!=="all"||o||i?{label:"Reset filters",onClick:()=>{x("all"),u(""),f("")}}:void 0}):e.jsx(H,{runs:_,total:$,limit:S,offset:m,onPageChange:j,selectedIds:a,onSelectionChange:p}),e.jsx(T,{open:g==="delete",title:"Delete Runs",description:`Delete ${a.size} selected run${a.size>1?"s":""}? This cannot be undone.`,confirmLabel:h?"Deleting...":"Delete All",variant:"danger",onConfirm:L,onCancel:()=>l(null)}),e.jsx(T,{open:g==="cancel",title:"Cancel Runs",description:`Cancel ${a.size} selected run${a.size>1?"s":""}?`,confirmLabel:h?"Cancelling...":"Cancel All",variant:"warning",onConfirm:P,onCancel:()=>l(null)})]})}export{re as default};
