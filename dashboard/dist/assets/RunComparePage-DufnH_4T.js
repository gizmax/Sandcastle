import{c as g,j as e,f as l,b as x,a as m,n as S,u as C,r as i,i as A,L as R}from"./index-CwcY_0GV.js";import{R as j}from"./RunStatusBadge-CZgT1mF0.js";import{E as B}from"./EmptyState-BQhpdpld.js";import{G as D}from"./git-compare-arrows-YwL7UdUk.js";import{A as $}from"./arrow-left-Kd_Li62L.js";const M=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],v=g("arrow-down",M);const O=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],w=g("arrow-up",O);const E=[["path",{d:"M5 12h14",key:"1ays0h"}]],y=g("minus",E);function b({delta:s,unit:r,invert:t}){if(Math.abs(s)<.001)return e.jsxs("span",{className:"text-muted text-xs flex items-center gap-0.5",children:[e.jsx(y,{className:"h-3 w-3"}),"same"]});const a=t?s>0:s<0;return e.jsxs("span",{className:m("text-xs font-medium flex items-center gap-0.5",a?"text-success":"text-error"),children:[a?e.jsx(v,{className:"h-3 w-3"}):e.jsx(w,{className:"h-3 w-3"}),s>0?"+":"",r==="$"?l(Math.abs(s)):x(Math.abs(s))]})}function N({status:s}){if(!s)return e.jsx("span",{className:"text-xs text-muted",children:"-"});const r={completed:"bg-success",failed:"bg-error",running:"bg-running",pending:"bg-muted",skipped:"bg-muted"};return e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs capitalize",children:[e.jsx("span",{className:m("h-1.5 w-1.5 rounded-full",r[s]||"bg-muted")}),s]})}function L({step:s}){const r=s.presence==="only_a",t=s.presence==="only_b";return e.jsxs("div",{className:m("rounded-xl border bg-surface p-4 shadow-sm",r?"border-error/30 bg-error/5":t?"border-success/30 bg-success/5":"border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-semibold text-foreground",children:s.step_id}),s.parallel_index!==null&&e.jsxs("span",{className:"rounded bg-accent/10 px-1.5 py-0.5 text-xs text-accent",children:["[",s.parallel_index,"]"]}),r&&e.jsx("span",{className:"rounded bg-error/15 px-1.5 py-0.5 text-xs text-error",children:"Only in Run A"}),t&&e.jsx("span",{className:"rounded bg-success/15 px-1.5 py-0.5 text-xs text-success",children:"Only in Run B"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{status:s.status_a}),e.jsx("span",{className:"text-muted text-xs",children:"vs"}),e.jsx(N,{status:s.status_b})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{className:"rounded-lg bg-background/50 p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Cost"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:l(s.cost_a)}),e.jsx("span",{className:"text-muted text-xs",children:"vs"}),e.jsx("span",{className:"text-sm font-medium",children:l(s.cost_b)})]}),e.jsx(b,{delta:s.cost_delta,unit:"$"})]})]}),e.jsxs("div",{className:"rounded-lg bg-background/50 p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Duration"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:x(s.duration_a)}),e.jsx("span",{className:"text-muted text-xs",children:"vs"}),e.jsx("span",{className:"text-sm font-medium",children:x(s.duration_b)})]}),e.jsx(b,{delta:s.duration_delta,unit:"s"})]})]})]}),s.config_changed&&s.config_a&&s.config_b&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-warning mb-1",children:"Config Changed"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded bg-error/5 p-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-0.5",children:"Run A"}),e.jsx("pre",{className:"text-xs font-mono text-foreground overflow-auto max-h-24",children:JSON.stringify(s.config_a,null,2)})]}),e.jsxs("div",{className:"rounded bg-success/5 p-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-0.5",children:"Run B"}),e.jsx("pre",{className:"text-xs font-mono text-foreground overflow-auto max-h-24",children:JSON.stringify(s.config_b,null,2)})]})]})]}),s.output_changed&&s.presence==="both"&&e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-xs font-medium text-accent hover:text-accent-hover",children:"Output differs - click to expand"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded bg-background/80 p-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-0.5",children:"Run A"}),e.jsx("pre",{className:"text-xs font-mono text-foreground overflow-auto max-h-40 whitespace-pre-wrap",children:s.output_a?JSON.stringify(s.output_a,null,2):"-"})]}),e.jsxs("div",{className:"rounded bg-background/80 p-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-0.5",children:"Run B"}),e.jsx("pre",{className:"text-xs font-mono text-foreground overflow-auto max-h-40 whitespace-pre-wrap",children:s.output_b?JSON.stringify(s.output_b,null,2):"-"})]})]})]}),(s.error_a||s.error_b)&&e.jsxs("div",{className:"mt-2 space-y-1",children:[s.error_a&&e.jsxs("div",{className:"rounded bg-error/10 px-2 py-1 text-xs text-error",children:[e.jsx("span",{className:"font-medium",children:"A:"})," ",s.error_a]}),s.error_b&&e.jsxs("div",{className:"rounded bg-error/10 px-2 py-1 text-xs text-error",children:[e.jsx("span",{className:"font-medium",children:"B:"})," ",s.error_b]})]})]})}function _({label:s,valueA:r,valueB:t,delta:a,format:u}){const o=u==="cost"?l:x,c=a!==null&&a<0,d=a!==null&&a>0;return e.jsxs("div",{className:"rounded-lg bg-background/50 p-3 text-center",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:r!==null?o(r):"-"}),e.jsx("span",{className:"text-muted text-xs",children:"vs"}),e.jsx("span",{className:"text-sm font-medium",children:t!==null?o(t):"-"})]}),a!==null&&e.jsxs("span",{className:m("text-xs font-medium inline-flex items-center gap-0.5",c?"text-success":d?"text-error":"text-muted"),children:[c?e.jsx(v,{className:"h-3 w-3"}):d?e.jsx(w,{className:"h-3 w-3"}):e.jsx(y,{className:"h-3 w-3"}),Math.abs(a)<.001?"same":`${a>0?"+":""}${o(Math.abs(a))}`]})]})}function I(){const[s]=S(),r=C(),[t,a]=i.useState(null),[u,o]=i.useState(!0),[c,d]=i.useState(null),h=s.get("run_a")||"",f=s.get("run_b")||"",p=i.useCallback(async()=>{if(!h||!f){d("Both run_a and run_b query parameters are required"),o(!1);return}try{const n=await A.get("/runs/compare",{run_a:h,run_b:f});n.data&&a(n.data),n.error&&d(n.error.message)}finally{o(!1)}},[h,f]);return i.useEffect(()=>{p()},[p]),u?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(R,{size:"lg"})}):c||!t?e.jsx("div",{className:"py-16",children:e.jsx(B,{icon:D,title:"Cannot compare runs",description:c||"No comparison data available"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("button",{onClick:()=>r(-1),className:"flex items-center gap-1 text-sm text-muted hover:text-foreground transition-colors",children:[e.jsx($,{className:"h-4 w-4"}),"Back"]}),e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-4 sm:p-5 shadow-sm",children:[e.jsx("h1",{className:"text-xl font-semibold tracking-tight text-foreground mb-4",children:"Replay Studio"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"rounded-lg border border-border p-3 cursor-pointer hover:border-accent/40 transition-colors",onClick:()=>r(`/runs/${t.run_a.run_id}`),children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Run A"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:t.run_a.workflow_name}),e.jsx(j,{status:t.run_a.status})]}),e.jsx("p",{className:"mt-1 font-mono text-xs text-muted truncate",children:t.run_a.run_id})]}),e.jsxs("div",{className:"rounded-lg border border-border p-3 cursor-pointer hover:border-accent/40 transition-colors",onClick:()=>r(`/runs/${t.run_b.run_id}`),children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Run B"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:t.run_b.workflow_name}),e.jsx(j,{status:t.run_b.status})]}),e.jsx("p",{className:"mt-1 font-mono text-xs text-muted truncate",children:t.run_b.run_id})]})]}),!t.same_workflow&&e.jsx("div",{className:"rounded-md bg-warning/10 px-3 py-2 mb-4 text-xs text-warning",children:"Different workflows - config comparison may not be meaningful"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(_,{label:"Total Cost",valueA:t.total_cost_a,valueB:t.total_cost_b,delta:t.total_cost_delta,format:"cost"}),e.jsx(_,{label:"Total Duration",valueA:t.total_duration_a,valueB:t.total_duration_b,delta:t.total_duration_delta,format:"duration"})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-3 text-sm font-semibold text-foreground",children:["Step Comparison (",t.steps.length," step",t.steps.length!==1?"s":"",")"]}),e.jsx("div",{className:"space-y-3",children:t.steps.map((n,k)=>e.jsx(L,{step:n},`${n.step_id}-${n.parallel_index??k}`))})]})]})}export{I as default};
