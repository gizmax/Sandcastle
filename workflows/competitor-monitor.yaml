name: "Competitor Monitor"
description: "Analyze competitor positioning, pricing, and strategy based on known market data and generate a summary report."
default_model: sonnet
default_max_turns: 10
default_timeout: 300

input_schema:
  required: ["company_name", "competitors"]
  properties:
    company_name:
      type: string
      description: "Name of the company whose competitors to analyze"
    competitors:
      type: array
      items:
        type: string
      description: "List of competitor names to analyze"

steps:
  - id: "analyze"
    prompt: |
      Analyze the competitor "{input._item}" in the context of {input.company_name}.
      Based on your knowledge, provide:
      - Current pricing structure and tiers
      - Key product features and recent changes
      - Marketing positioning and messaging
      - Strengths and weaknesses relative to {input.company_name}
    parallel_over: "input.competitors"
    retry:
      max_attempts: 2
      backoff: exponential
      on_failure: skip

  - id: "summarize"
    prompt: |
      Given these competitor analyses: {steps.analyze.output}
      Create a concise executive summary highlighting:
      - Key competitive movements
      - Pricing changes
      - New threats or opportunities
      - Recommended actions
    depends_on:
      - "analyze"

  - id: "format-report"
    prompt: |
      Format this competitive intelligence into a professional report:
      {steps.summarize.output}
      Use markdown formatting with sections and bullet points.
    depends_on:
      - "summarize"
    model: haiku

on_complete:
  storage_path: "reports/{run_id}/competitor-report.md"
  webhook: "${WEBHOOK_URL}"
