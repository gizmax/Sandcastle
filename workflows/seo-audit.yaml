name: "SEO Audit"
description: "Fetch a website homepage, analyze on-page SEO factors, and produce actionable recommendations. Note: analysis is limited to the homepage and any linked pages reachable via simple HTTP requests."
default_model: sonnet
default_max_turns: 15
default_timeout: 600

input_schema:
  required: ["target_url"]
  properties:
    target_url:
      type: string
      description: "URL of the website homepage to audit (the agent will fetch this single page via curl)"

steps:
  - id: "fetch-page"
    prompt: |
      Fetch the homepage at {input.target_url} using `curl -s -L {input.target_url} | head -c 100000`.
      Parse the HTML and extract:
      - URL, title tag, meta description
      - H1/H2 headings
      - Internal/external link count
      - Image alt text coverage
      - Canonical tag, robots meta
      - Open Graph tags
      - Structured data
      Return as structured JSON.
    output_schema:
      type: object
      properties:
        url: { type: string }
        title: { type: string }
        meta_description: { type: string }
        headings: { type: object }
        internal_links: { type: integer }
        external_links: { type: integer }
        image_alt_coverage: { type: string }
        canonical: { type: string }
        robots_meta: { type: string }
        open_graph: { type: object }
        structured_data: { type: object }

  - id: "analyze-technical"
    prompt: |
      Analyze this page data for technical SEO issues:
      {steps.fetch-page.output}
      Check for:
      - Missing/duplicate title tags
      - Missing meta description
      - Broken heading hierarchy
      - Missing alt text
      - Internal linking opportunities
      - Canonical tag issues
      - Open Graph completeness
      - Structured data validity
    depends_on:
      - "fetch-page"

  - id: "recommendations"
    prompt: |
      Based on this SEO analysis: {steps.analyze-technical.output}
      Produce a prioritized list of SEO recommendations.
      Group by: Critical, High, Medium, Low priority.
      Include estimated impact and implementation difficulty.
    depends_on:
      - "analyze-technical"
    model: haiku
    output_schema:
      type: object
      properties:
        critical: { type: array, items: { type: string } }
        high: { type: array, items: { type: string } }
        medium: { type: array, items: { type: string } }
        low: { type: array, items: { type: string } }

on_complete:
  storage_path: "audits/{run_id}/seo-report.json"
