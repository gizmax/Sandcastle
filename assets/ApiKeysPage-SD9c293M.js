import{j as e,h as K,a as d,r as s,X as I,T as R,i as g,L as F,K as M,D,t as L,E as z}from"./index-BxoS6zFR.js";import{C as S}from"./check-D_EyViqK.js";import{C as q}from"./copy-DfDhqOyB.js";import{E as U}from"./EmptyState-BPInumdg.js";import{P as Y}from"./plus-CB_U-jcF.js";function B({keys:a,onDeactivate:r}){return e.jsx("div",{className:"rounded-xl border border-border bg-surface shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-background/50",children:[e.jsx("th",{className:"px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Key"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Name"}),e.jsx("th",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Tenant"}),e.jsx("th",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Created"}),e.jsx("th",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-left font-medium text-muted",children:"Last Used"}),e.jsx("th",{className:"px-3 sm:px-5 py-3 text-right font-medium text-muted",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:a.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 sm:px-5 py-3",children:e.jsxs("code",{className:"rounded-md bg-background px-2 py-0.5 font-mono text-xs text-foreground",children:[n.key_prefix,"..."]})}),e.jsx("td",{className:"px-3 sm:px-5 py-3 font-medium text-foreground",children:n.name}),e.jsx("td",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-muted",children:n.tenant_id}),e.jsx("td",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-muted",children:K(n.created_at)}),e.jsx("td",{className:"hidden md:table-cell px-3 sm:px-5 py-3 text-muted",children:n.last_used_at?K(n.last_used_at):"Never"}),e.jsx("td",{className:"px-3 sm:px-5 py-3 text-right",children:e.jsx("button",{onClick:()=>r(n.id),className:d("rounded-lg border border-error/30 px-3 py-1 text-xs font-medium text-error/70","hover:bg-error/10 hover:text-error transition-colors"),children:"Deactivate"})})]},n.id))})]})})})}function X({open:a,onClose:r,onSubmit:n}){const[c,p]=s.useState(""),[u,b]=s.useState(""),[h,x]=s.useState("");if(!a)return null;function v(l){l.preventDefault();const i=h!==""?parseFloat(h):void 0;n({name:c,tenant_id:u,...i!==void 0?{max_cost_per_run_usd:i}:{}}),p(""),b(""),x("")}const o=d("h-9 w-full rounded-lg border border-border bg-background px-3 text-sm","focus:border-accent/50 focus:outline-none focus:ring-2 focus:ring-ring/30");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40",onClick:r}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-xl border border-border bg-surface p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Create API Key"}),e.jsx("button",{onClick:r,className:"rounded-lg p-1 text-muted hover:text-foreground",children:e.jsx(I,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Key Name"}),e.jsx("input",{type:"text",value:c,onChange:l=>p(l.target.value),placeholder:"e.g. Production API",required:!0,className:o}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:"Label for identifying this key in the dashboard."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Tenant ID"}),e.jsx("input",{type:"text",value:u,onChange:l=>b(l.target.value),placeholder:"e.g. acme-corp",required:!0,className:o}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:"All runs created with this key are scoped to this tenant."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-muted",children:"Max Cost per Run (USD)"}),e.jsx("input",{type:"number",value:h,onChange:l=>x(l.target.value),placeholder:"e.g. 5.00",min:"0",step:"0.01",className:o}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5",children:"Budget limit per run for this API key. Leave empty for unlimited."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:r,className:"rounded-lg border border-border px-4 py-2 text-sm font-medium text-muted hover:text-foreground transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:d("rounded-lg bg-accent px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200","shadow-sm hover:shadow-md"),children:"Create Key"})]})]})]})})]})}function $({apiKey:a,onClose:r}){const[n,c]=s.useState(!1);function p(){navigator.clipboard.writeText(a),c(!0),setTimeout(()=>c(!1),2e3)}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40",onClick:r}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl border border-border bg-surface p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"API Key Created"}),e.jsx("button",{onClick:r,className:"rounded-lg p-1 text-muted hover:text-foreground",children:e.jsx(I,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-4 flex items-start gap-3 rounded-lg border border-warning/30 bg-warning/5 px-4 py-3",children:[e.jsx(R,{className:"mt-0.5 h-4 w-4 shrink-0 text-warning"}),e.jsx("p",{className:"text-sm text-warning",children:"Save this key now. It will not be shown again."})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2 rounded-lg border border-border bg-background px-4 py-3",children:[e.jsx("code",{className:"flex-1 break-all font-mono text-sm text-foreground",children:a}),e.jsx("button",{onClick:p,className:d("shrink-0 rounded-lg border border-border p-2 transition-colors",n?"border-success/30 bg-success/10 text-success":"text-muted hover:text-foreground hover:bg-background"),children:n?e.jsx(S,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:r,className:d("rounded-lg bg-accent px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200","shadow-sm hover:shadow-md"),children:"Done"})})]})})]})}function H({icon:a,title:r,description:n,children:c}){return e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-5 sm:p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-accent/10",children:e.jsx(a,{className:"h-[18px] w-[18px] text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:r}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:n})]})]}),c]})}function y({htmlFor:a,children:r}){return e.jsx("label",{htmlFor:a,className:"block text-sm font-medium text-foreground mb-1.5",children:r})}function V({children:a}){return e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a})}const j=d("h-9 w-full rounded-lg border border-border bg-background px-3 text-sm text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring/30","transition-colors");function G({message:a,type:r}){return e.jsxs("div",{className:d("fixed bottom-6 right-6 z-50 flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium shadow-lg","animate-[fadeIn_0.2s_ease-out]",r==="success"?"bg-success/15 border border-success/30 text-success":"bg-error/15 border border-error/30 text-error"),children:[r==="success"?e.jsx(S,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"}),a]})}function te(){const[a,r]=s.useState([]),[n,c]=s.useState(!0),[p,u]=s.useState(!1),[b,h]=s.useState(null),[x,v]=s.useState(""),[o,l]=s.useState(""),i=s.useRef(null),[k,w]=s.useState(!1),[f,_]=s.useState(null),N=s.useCallback(async()=>{try{const t=await g.get("/api-keys");t.data&&r(t.data)}finally{c(!1)}},[]),C=s.useCallback(async()=>{const t=await g.get("/settings");t.data&&(v(t.data.anthropic_api_key),l(t.data.e2b_api_key),i.current={anthropic_api_key:t.data.anthropic_api_key,e2b_api_key:t.data.e2b_api_key})},[]);s.useEffect(()=>{N(),C()},[N,C]),s.useEffect(()=>{if(!f)return;const t=setTimeout(()=>_(null),3e3);return()=>clearTimeout(t)},[f]);const P=s.useCallback(async t=>{const m=await g.post("/api-keys",t);u(!1),m.data&&"key"in m.data&&(h(m.data.key),N())},[N]),E=s.useCallback(async t=>{await g.delete(`/api-keys/${t}`),r(m=>m.filter(O=>O.id!==t))},[]),A=i.current!=null&&(x!==i.current.anthropic_api_key||o!==i.current.e2b_api_key),T=s.useCallback(async()=>{if(!i.current)return;const t={};if(x!==i.current.anthropic_api_key&&(t.anthropic_api_key=x),o!==i.current.e2b_api_key&&(t.e2b_api_key=o),Object.keys(t).length===0)return;w(!0);const m=await g.patch("/settings",t);w(!1),m.error?_({message:`Failed to save: ${m.error.message}`,type:"error"}):(i.current={anthropic_api_key:x,e2b_api_key:o},_({message:"Credentials saved successfully",type:"success"}))},[x,o]);return n?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(F,{size:"lg"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"API Keys"}),e.jsxs("button",{onClick:()=>u(!0),className:d("flex items-center gap-2 rounded-lg bg-accent px-3 sm:px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200","shadow-sm hover:shadow-md"),children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"New API Key"})]})]}),a.length===0?e.jsx(U,{icon:M,title:"No API keys yet",description:"Create your first API key to authenticate requests.",action:{label:"Create API Key",onClick:()=>u(!0)}}):e.jsx(B,{keys:a,onDeactivate:E}),e.jsx(H,{icon:D,title:"External Services",description:"API keys for AI providers and sandbox runtimes",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"anthropic_api_key",children:"Anthropic API Key"}),e.jsx("input",{id:"anthropic_api_key",type:"password",className:j,value:x,onChange:t=>v(t.target.value),placeholder:i.current?.anthropic_api_key||"sk-ant-..."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"e2b_api_key",children:"E2B API Key"}),e.jsx("input",{id:"e2b_api_key",type:"password",className:j,value:o,onChange:t=>l(t.target.value),placeholder:i.current?.e2b_api_key||"e2b_..."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"openai_api_key_hint",children:"OpenAI API Key"}),e.jsx("input",{id:"openai_api_key_hint",type:"text",className:d(j,"bg-border/30 cursor-not-allowed"),readOnly:!0,placeholder:"Set via OPENAI_API_KEY env var"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"minimax_api_key_hint",children:"MiniMax API Key"}),e.jsx("input",{id:"minimax_api_key_hint",type:"text",className:d(j,"bg-border/30 cursor-not-allowed"),readOnly:!0,placeholder:"Set via MINIMAX_API_KEY env var"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"openrouter_api_key_hint",children:"OpenRouter API Key"}),e.jsx("input",{id:"openrouter_api_key_hint",type:"text",className:d(j,"bg-border/30 cursor-not-allowed"),readOnly:!0,placeholder:"Set via OPENROUTER_API_KEY env var"})]}),e.jsx(V,{children:"Leave empty to keep the current value. Values are masked for security."}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{disabled:!A||k,onClick:()=>{T()},className:d("flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors",A?"bg-accent text-accent-foreground hover:bg-accent-hover shadow-sm hover:shadow-md cursor-pointer":"bg-border text-muted cursor-not-allowed"),children:[k&&e.jsx(L,{className:"h-3.5 w-3.5 animate-spin"}),"Save"]})})]})}),e.jsx(X,{open:p,onClose:()=>u(!1),onSubmit:P}),b&&e.jsx($,{apiKey:b,onClose:()=>h(null)}),f&&e.jsx(G,{message:f.message,type:f.type})]})}export{te as default};
