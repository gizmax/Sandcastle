import{c as y,j as e,G as v,a as b,r as x,u as C,i as k,L as M}from"./index-BxoS6zFR.js";import{t as E}from"./index-BtCl_quS.js";import{P as W}from"./play-CiRW9BCK.js";import{i as L,S as R,B as S,C as D,R as $}from"./StepNode-0-eridk3.js";import{E as z}from"./EmptyState-BPInumdg.js";import{P as G}from"./plus-CB_U-jcF.js";import"./index-iCV9RHQg.js";import"./JsonEditor-DNOXJmHX.js";import"./value-6M4gC9Xa.js";import"./file-text-C_J2fgJl.js";const P=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],A=y("eye",P);const B=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],I=y("history",B);const O=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],V=y("pencil",O);function F({name:r,description:d,stepsCount:m,version:u,versionStatus:o,totalVersions:t,onRun:n,onEdit:c,onViewDag:h,onViewVersions:i}){return e.jsxs("div",{className:b("rounded-xl border border-border bg-surface p-5 shadow-sm","transition-all duration-200 hover:shadow-md hover:border-accent/30"),children:[e.jsxs("div",{className:"mb-3 flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-accent/10",children:e.jsx(v,{className:"h-5 w-5 text-accent"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"truncate text-sm font-semibold text-foreground",children:r}),e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted",children:d})]})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[m," step",m!==1?"s":""]}),u!=null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{className:"font-mono",children:["v",u]}),o&&e.jsx("span",{className:b("rounded-full px-1.5 py-0.5 text-[10px] font-medium capitalize",o==="production"?"bg-success/15 text-success":o==="staging"?"bg-warning/15 text-warning":"bg-muted/15 text-muted"),children:o})]}),t!=null&&t>1&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t," versions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:n,className:b("flex items-center gap-1.5 rounded-lg bg-accent px-3 py-1.5 text-xs font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200 shadow-sm"),children:[e.jsx(W,{className:"h-3 w-3"}),"Run"]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-1.5 rounded-lg border border-border px-3 py-1.5 text-xs font-medium text-muted hover:text-foreground hover:bg-border/40 transition-colors",children:[e.jsx(A,{className:"h-3 w-3"}),"DAG"]}),e.jsxs("button",{onClick:c,className:"flex items-center gap-1.5 rounded-lg border border-border px-3 py-1.5 text-xs font-medium text-muted hover:text-foreground hover:bg-border/40 transition-colors",children:[e.jsx(V,{className:"h-3 w-3"}),"Edit"]}),i&&e.jsxs("button",{onClick:i,className:"flex items-center gap-1.5 rounded-lg border border-border px-3 py-1.5 text-xs font-medium text-muted hover:text-foreground hover:bg-border/40 transition-colors",children:[e.jsx(I,{className:"h-3 w-3"}),"Versions"]})]})]})}function q({workflows:r,onRun:d,onEdit:m,onViewDag:u,onViewVersions:o}){return e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:r.map(t=>e.jsx(F,{name:t.name,description:t.description,stepsCount:t.steps_count,fileName:t.file_name,version:t.version,versionStatus:t.version_status,totalVersions:t.total_versions,onRun:()=>d(t),onEdit:()=>m(t),onViewDag:()=>u(t),onViewVersions:o?()=>o(t):void 0},t.file_name))})}const H={step:R};function T({steps:r,className:d}){const{nodes:m,edges:u}=x.useMemo(()=>{const o=new Map,t=new Map;r.forEach(s=>{o.set(s.id,s.depends_on||[]),t.set(s.id,s)});const n=new Map,c=new Set;function h(s){if(n.has(s))return n.get(s);if(c.has(s))return 0;c.add(s);const a=o.get(s)||[];if(a.length===0)return n.set(s,0),0;const g=Math.max(...a.map(h))+1;return n.set(s,g),g}r.forEach(s=>h(s.id));const i=new Map;r.forEach(s=>{const a=n.get(s.id)||0;i.has(a)||i.set(a,[]),i.get(a).push(s.id)});const w=200,l=120,p=r.map(s=>{const a=n.get(s.id)||0,j=i.get(a)||[s.id],g=j.indexOf(s.id),N=j.length,_=(g-(N-1)/2)*w;return{id:s.id,type:"step",position:{x:300+_,y:a*l+50},data:{label:s.id,model:s.model,status:s.status}}}),f=[];return r.forEach(s=>{(s.depends_on||[]).forEach(a=>{f.push({id:`${a}-${s.id}`,source:a,target:s.id,animated:s.status==="running",style:{stroke:"var(--color-accent)",strokeWidth:2}})})}),{nodes:p,edges:f}},[r]);return e.jsx("div",{className:d,style:{height:"400px"},children:e.jsxs(L,{nodes:m,edges:u,nodeTypes:H,fitView:!0,proOptions:{hideAttribution:!0},nodesDraggable:!1,nodesConnectable:!1,children:[e.jsx(S,{gap:16,size:1,color:"var(--color-border)"}),e.jsx(D,{showInteractive:!1,className:"!bg-surface !border-border !shadow-sm"})]})})}function re(){const r=C(),[d,m]=x.useState([]),[u,o]=x.useState(!0),[t,n]=x.useState(null),[c,h]=x.useState(null),i=x.useCallback(async()=>{try{const l=await k.get("/workflows");l.data&&m(l.data)}finally{o(!1)}},[]);x.useEffect(()=>{i()},[i]);const w=x.useCallback(async(l,p)=>{if(!t)return;const f=await k.post("/workflows/run",{workflow_name:t.file_name.replace(".yaml",""),input:l,callback_url:p});if(n(null),f.error){E.error(`Run failed: ${f.error.message}`);return}r("/runs")},[t,r]);return u?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(M,{size:"lg"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Workflows"}),e.jsxs("button",{onClick:()=>r("/workflows/builder"),className:b("flex items-center gap-2 rounded-lg bg-accent px-3 sm:px-4 py-2 text-sm font-medium text-accent-foreground","hover:bg-accent-hover transition-all duration-200 shadow-sm hover:shadow-md"),children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"New Workflow"})]})]}),d.length===0?e.jsx(z,{icon:v,title:"No workflows found",description:"Build your first workflow!",action:{label:"Create Workflow",onClick:()=>r("/workflows/builder")}}):e.jsx(q,{workflows:d,onRun:n,onEdit:l=>r("/workflows/builder",{state:{workflow:l}}),onViewDag:h,onViewVersions:l=>r(`/workflows/${l.file_name.replace(".yaml","")}`)}),c&&e.jsxs("div",{className:"rounded-xl border border-border bg-surface shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-5 py-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground",children:["DAG - ",c.name]}),e.jsx("button",{onClick:()=>h(null),className:"text-xs text-muted hover:text-foreground",children:"Close"})]}),e.jsx(T,{steps:c.steps||Array.from({length:c.steps_count},(l,p)=>({id:`step_${p+1}`}))})]}),t&&e.jsx($,{open:!0,workflowName:t.name,inputSchema:t.input_schema,onClose:()=>n(null),onRun:w})]})}export{re as default};
