import{c as w,r as n,H,i as D,j as e,L as O,E as I,J as W,t as T,a}from"./index-BxoS6zFR.js";import{D as z}from"./dollar-sign-CVTVnX7Q.js";import{S as U}from"./server-Ci4ypuis.js";import{C as P}from"./check-D_EyViqK.js";const B=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],V=w("link",B);const G=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],A=w("log-out",G);const J=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],K=w("shield",J);const Q=[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]],X=w("webhook",Q);const Y=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],Z=w("wrench",Y),ee=["debug","info","warning","error"];function j(s,o){const c={};for(const i of Object.keys(s))s[i]!==o[i]&&(c[i]=s[i]);return c}function u({icon:s,title:o,description:c,children:i}){return e.jsxs("div",{className:"rounded-xl border border-border bg-surface p-5 sm:p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-accent/10",children:e.jsx(s,{className:"h-[18px] w-[18px] text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:o}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:c})]})]}),i]})}function h({htmlFor:s,children:o}){return e.jsx("label",{htmlFor:s,className:"block text-sm font-medium text-foreground mb-1.5",children:o})}function y({children:s}){return e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s})}const g=a("h-9 w-full rounded-lg border border-border bg-background px-3 text-sm text-foreground","placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring/30","transition-colors");function v({dirty:s,saving:o,onClick:c}){return e.jsxs("button",{disabled:!s||o,onClick:c,className:a("flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors",s?"bg-accent text-accent-foreground hover:bg-accent-hover shadow-sm hover:shadow-md cursor-pointer":"bg-border text-muted cursor-not-allowed"),children:[o&&e.jsx(T,{className:"h-3.5 w-3.5 animate-spin"}),"Save"]})}function se({message:s,type:o}){return e.jsxs("div",{className:a("fixed bottom-6 right-6 z-50 flex items-center gap-2 rounded-lg px-4 py-3 text-sm font-medium shadow-lg","animate-[fadeIn_0.2s_ease-out]",o==="success"?"bg-success/15 border border-success/30 text-success":"bg-error/15 border border-error/30 text-error"),children:[o==="success"?e.jsx(P,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"}),s]})}function ae(){const[s,o]=n.useState(null),[c,i]=n.useState(!0),[C,q]=n.useState(null),[f,L]=n.useState(new Set),[p,m]=n.useState(null),[k,M]=n.useState(!1),{info:F}=H(),d=n.useRef(null),N=n.useCallback(async()=>{q(null);const t=await D.get("/settings");t.data?(o(t.data),d.current={...t.data}):t.error&&q(t.error.message||"Failed to load settings"),i(!1)},[]);n.useEffect(()=>{N()},[N]),n.useEffect(()=>{if(!p)return;const t=setTimeout(()=>m(null),3e3);return()=>clearTimeout(t)},[p]);function l(t,r){o(x=>x&&{...x,[t]:r})}function _(t){if(!s||!d.current)return!1;const r=d.current;switch(t){case"connections":return s.sandstorm_url!==r.sandstorm_url;case"security":return s.auth_required!==r.auth_required||s.dashboard_origin!==r.dashboard_origin;case"budget":return s.default_max_cost_usd!==r.default_max_cost_usd;case"webhooks":return s.webhook_secret!==r.webhook_secret;case"system":return s.log_level!==r.log_level||s.max_workflow_depth!==r.max_workflow_depth}}function E(t){if(!s||!d.current)return{};const r=d.current;switch(t){case"connections":return j({sandstorm_url:s.sandstorm_url},{sandstorm_url:r.sandstorm_url});case"security":return j({auth_required:s.auth_required,dashboard_origin:s.dashboard_origin},{auth_required:r.auth_required,dashboard_origin:r.dashboard_origin});case"budget":return j({default_max_cost_usd:s.default_max_cost_usd},{default_max_cost_usd:r.default_max_cost_usd});case"webhooks":return j({webhook_secret:s.webhook_secret},{webhook_secret:r.webhook_secret});case"system":return j({log_level:s.log_level,max_workflow_depth:s.max_workflow_depth},{log_level:r.log_level,max_workflow_depth:r.max_workflow_depth})}}const b=n.useCallback(async t=>{const r=E(t);if(Object.keys(r).length===0)return;L(S=>new Set(S).add(t));const x=await D.patch("/settings",r);L(S=>{const R=new Set(S);return R.delete(t),R}),x.error?m({message:`Failed to save: ${x.error.message}`,type:"error"}):(d.current&&s&&(d.current={...s}),m({message:"Settings saved successfully",type:"success"}))},[s]),$=n.useCallback(async()=>{if(s){M(!0);try{const t=await fetch(`${s.sandstorm_url}/health`,{signal:AbortSignal.timeout(5e3)});t.ok?m({message:"Connection to Sandshore successful",type:"success"}):m({message:`Sandshore returned HTTP ${t.status}`,type:"error"})}catch{m({message:"Could not reach Sandshore at this URL",type:"error"})}M(!1)}},[s]);return c?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(O,{size:"lg"})}):C||!s?e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center gap-3",children:[e.jsx(I,{className:"h-8 w-8 text-error"}),e.jsx("p",{className:"text-sm text-muted",children:C||"Could not load settings"}),e.jsx("button",{onClick:()=>{i(!0),N()},className:"rounded-lg border border-border px-4 py-2 text-sm font-medium text-foreground hover:bg-border/40 transition-colors",children:"Retry"})]}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-6 w-6 text-muted"}),e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Settings"})]}),e.jsx(u,{icon:V,title:"Connections",description:"Configure the upstream Sandshore runtime URL",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"sandstorm_url",children:"Sandshore URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"sandstorm_url",type:"text",className:g,value:s.sandstorm_url,onChange:t=>l("sandstorm_url",t.target.value),placeholder:"http://localhost:8080"}),e.jsx("button",{onClick:$,disabled:k,className:a("shrink-0 rounded-lg border border-border px-3 py-2 text-sm font-medium","text-muted hover:text-foreground hover:bg-border/40 transition-colors",k&&"opacity-50 cursor-not-allowed"),children:k?e.jsx(T,{className:"h-4 w-4 animate-spin"}):"Test"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{dirty:_("connections"),saving:f.has("connections"),onClick:()=>{b("connections")}})})]})}),e.jsx(u,{icon:K,title:"Security",description:"Authentication and CORS settings",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Auth Required"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Require API key authentication for all requests"})]}),e.jsx("button",{role:"switch","aria-checked":s.auth_required,onClick:()=>l("auth_required",!s.auth_required),className:a("relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors",s.auth_required?"bg-accent":"bg-border"),children:e.jsx("span",{className:a("pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow-sm transition-transform",s.auth_required?"translate-x-5":"translate-x-0")})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"dashboard_origin",children:"Dashboard Origin"}),e.jsx("input",{id:"dashboard_origin",type:"text",className:g,value:s.dashboard_origin,onChange:t=>l("dashboard_origin",t.target.value),placeholder:"http://localhost:5173"}),e.jsx(y,{children:"Allowed CORS origin for the dashboard"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{dirty:_("security"),saving:f.has("security"),onClick:()=>{b("security")}})})]})}),e.jsx(u,{icon:z,title:"Budget & Costs",description:"Default cost limits for workflow runs",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"default_max_cost_usd",children:"Default Max Cost per Run (USD)"}),e.jsx("input",{id:"default_max_cost_usd",type:"number",min:0,step:.01,className:a(g,"max-w-xs"),value:s.default_max_cost_usd,onChange:t=>l("default_max_cost_usd",parseFloat(t.target.value)||0)}),e.jsx(y,{children:"0 = unlimited"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{dirty:_("budget"),saving:f.has("budget"),onClick:()=>{b("budget")}})})]})}),e.jsx(u,{icon:X,title:"Webhooks",description:"Webhook HMAC signing configuration",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"webhook_secret",children:"Webhook Secret"}),e.jsx("input",{id:"webhook_secret",type:"password",className:g,value:s.webhook_secret,onChange:t=>l("webhook_secret",t.target.value),placeholder:d.current?.webhook_secret||"whsec_..."}),e.jsx(y,{children:"Used to sign outgoing webhook payloads (HMAC-SHA256)"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{dirty:_("webhooks"),saving:f.has("webhooks"),onClick:()=>{b("webhooks")}})})]})}),e.jsx(u,{icon:Z,title:"System",description:"Logging and execution limits",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"log_level",children:"Log Level"}),e.jsx("select",{id:"log_level",className:a(g,"max-w-xs cursor-pointer"),value:s.log_level,onChange:t=>l("log_level",t.target.value),children:ee.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"max_workflow_depth",children:"Max Workflow Depth"}),e.jsx("input",{id:"max_workflow_depth",type:"number",min:1,max:20,className:a(g,"max-w-xs"),value:s.max_workflow_depth,onChange:t=>l("max_workflow_depth",Math.min(20,Math.max(1,parseInt(t.target.value,10)||1)))}),e.jsx(y,{children:"Maximum nesting depth for sub-workflows (1-20)"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{dirty:_("system"),saving:f.has("system"),onClick:()=>{b("system")}})})]})}),localStorage.getItem("sandcastle_api_key")&&e.jsx(u,{icon:A,title:"Session",description:"Connected via saved API key",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Key: ",e.jsxs("span",{className:"font-mono",children:[localStorage.getItem("sandcastle_api_key")?.slice(0,8),"..."]})]}),e.jsxs("button",{onClick:()=>{localStorage.removeItem("sandcastle_api_key"),window.location.reload()},className:"flex items-center gap-2 rounded-lg border border-error/30 px-3 py-1.5 text-sm font-medium text-error hover:bg-error/10 transition-colors cursor-pointer",children:[e.jsx(A,{className:"h-3.5 w-3.5"}),"Disconnect"]})]})}),e.jsx(u,{icon:U,title:"Infrastructure",description:"Runtime environment and storage configuration (read-only)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Mode"}),e.jsx("span",{className:a("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.is_local_mode?"bg-accent/15 border border-accent/30 text-accent":"bg-success/15 border border-success/30 text-success"),children:s.is_local_mode?"Local":"Production"})]}),F&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Sandbox Backend"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-accent/15 border border-accent/30 text-accent capitalize",children:F.sandbox_backend})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Database"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.database_url||"Not configured"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Queue"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.redis_url||"In-process"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Storage"}),e.jsxs("p",{className:"text-sm text-muted-foreground font-mono truncate",children:[s.storage_backend,s.storage_bucket?` / ${s.storage_bucket}`:"",s.storage_endpoint?` (${s.storage_endpoint})`:""]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Data Directory"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.data_dir||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Workflows Directory"}),e.jsx("p",{className:"text-sm text-muted-foreground font-mono truncate",children:s.workflows_dir||"-"})]})]})]})}),p&&e.jsx(se,{message:p.message,type:p.type})]})}export{ae as default};
