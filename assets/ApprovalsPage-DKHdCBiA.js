import{c as h,u as C,r as n,i as p,j as e,L as S,a,v as A,l as m,h as E}from"./index-BxoS6zFR.js";import{E as P}from"./EmptyState-BPInumdg.js";import{C as u}from"./circle-check-Bk-V9RBU.js";const R=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],T=h("clock",R);const I=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],g=h("skip-forward",I),b={pending:{bg:"bg-warning/15 border-warning/30",text:"text-warning",dot:"bg-warning animate-pulse",label:"Pending"},approved:{bg:"bg-success/15 border-success/30",text:"text-success",dot:"bg-success",label:"Approved"},rejected:{bg:"bg-error/15 border-error/30",text:"text-error",dot:"bg-error",label:"Rejected"},skipped:{bg:"bg-muted/15 border-muted/30",text:"text-muted",dot:"bg-muted",label:"Skipped"},timed_out:{bg:"bg-muted/15 border-muted/30",text:"text-muted",dot:"bg-muted",label:"Timed Out"}};function z(){const f=C(),[l,j]=n.useState([]),[v,N]=n.useState(!0),[o,y]=n.useState("all"),[k,w]=n.useState(null),d=n.useCallback(async()=>{try{const s={};o!=="all"&&(s.status=o);const t=await p.get("/approvals",s);t.data&&j(t.data)}finally{N(!1)}},[o]);n.useEffect(()=>{d()},[d]);const c=n.useCallback(async(s,t)=>{await p.post(`/approvals/${s}/${t}`),d()},[d]),_=[{key:"all",label:"All"},{key:"pending",label:"Pending"},{key:"approved",label:"Approved"},{key:"rejected",label:"Rejected"}],i=l.filter(s=>s.status==="pending").length;return v?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(S,{size:"lg"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight text-foreground",children:"Approval Gates"}),i>0&&e.jsx("span",{className:"flex h-6 min-w-6 items-center justify-center rounded-full bg-warning px-2 text-xs font-semibold text-white",children:i})]})}),e.jsx("div",{className:"flex gap-1 rounded-lg bg-background p-1",children:_.map(s=>e.jsx("button",{onClick:()=>y(s.key),className:a("rounded-md px-3 py-1.5 text-sm font-medium transition-all duration-200",o===s.key?"bg-surface text-foreground shadow-sm":"text-muted hover:text-foreground"),children:s.label},s.key))}),l.length===0?e.jsx(P,{icon:A,title:"No approvals",description:"Workflow steps requiring human review will appear here."}):e.jsx("div",{className:"space-y-3",children:l.map(s=>{const t=b[s.status]||b.pending,x=k===s.id;return e.jsxs("div",{className:"rounded-xl border border-border bg-surface shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 px-3 sm:px-5 py-3 sm:py-4 cursor-pointer hover:bg-border/10 transition-colors",onClick:()=>w(x?null:s.id),children:[e.jsx("div",{className:a("flex h-10 w-10 shrink-0 items-center justify-center rounded-lg",t.bg,"border"),children:s.status==="pending"?e.jsx(T,{className:a("h-5 w-5",t.text)}):s.status==="approved"?e.jsx(u,{className:a("h-5 w-5",t.text)}):s.status==="rejected"?e.jsx(m,{className:a("h-5 w-5",t.text)}):e.jsx(g,{className:a("h-5 w-5",t.text)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s.message}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),f(`/runs/${s.run_id}`)},className:"text-xs font-medium text-accent hover:text-accent-hover transition-colors",children:s.step_id}),e.jsx("span",{className:"text-xs text-muted",children:s.created_at?E(s.created_at):""}),s.timeout_at&&s.status==="pending"&&e.jsxs("span",{className:"text-xs text-warning",children:["Timeout: ",s.on_timeout]})]})]}),e.jsxs("span",{className:a("inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium",t.bg,t.text),children:[e.jsx("span",{className:a("h-1.5 w-1.5 rounded-full",t.dot)}),t.label]}),s.status==="pending"&&e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[e.jsxs("button",{onClick:r=>{r.stopPropagation(),c(s.id,"approve")},className:a("flex items-center gap-1 rounded-md px-2.5 py-1.5 text-xs font-medium","bg-success/10 text-success hover:bg-success/20 transition-colors"),children:[e.jsx(u,{className:"h-3.5 w-3.5"}),"Approve"]}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),c(s.id,"reject")},className:a("flex items-center gap-1 rounded-md px-2.5 py-1.5 text-xs font-medium","bg-error/10 text-error hover:bg-error/20 transition-colors"),children:[e.jsx(m,{className:"h-3.5 w-3.5"}),"Reject"]}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),c(s.id,"skip")},className:a("flex items-center gap-1 rounded-md px-2.5 py-1.5 text-xs font-medium","text-muted hover:bg-border/40 transition-colors"),children:[e.jsx(g,{className:"h-3.5 w-3.5"}),"Skip"]})]})]}),x&&s.request_data&&e.jsxs("div",{className:"border-t border-border px-5 py-4 bg-background/50",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Request Data"}),e.jsx("pre",{className:"max-h-48 overflow-auto rounded-lg bg-surface border border-border p-3 font-mono text-xs text-muted",children:JSON.stringify(s.request_data,null,2)}),s.allow_edit&&s.status==="pending"&&e.jsx("p",{className:"mt-2 text-xs text-accent",children:"Editing allowed - reviewer can modify data before approving"}),s.reviewer_comment&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reviewer Comment"}),e.jsx("p",{className:"text-sm text-foreground",children:s.reviewer_comment})]})]})]},s.id)})})]})}export{z as default};
